/*
* EASYDROPDOWN - A Drop-down Builder for Styleable Inputs and Menus
* Version: 2.1.5
* License: Creative Commons Attribution 3.0 Unported - CC BY 3.0
* http://creativecommons.org/licenses/by/3.0/
* This software may be used freely on commercial and non-commercial projects with attribution to the author/copyright holder.
* Author: Patrick Kunka
* Copyright 2013 Patrick Kunka, All Rights Reserved
*/
!function($){function EasyDropDown(){this.isField=!0,this.down=!1,this.inFocus=!1,this.disabled=!1,this.cutOff=!1,this.hasLabel=!1,this.keyboardMode=!1,this.nativeTouch=!0,this.wrapperClass="dropdown",this.onChange=null}EasyDropDown.prototype={constructor:EasyDropDown,instances:{},init:function(domNode,settings){var self=this;$.extend(self,settings),self.settings=settings,self.$select=$(domNode),self.id=domNode.id,self.options=[],self.$options=self.$select.find("option"),self.isTouch="ontouchend"in document,self.$select.removeClass(self.wrapperClass+" dropdown"),self.$select.is(":disabled")&&(self.disabled=!0),self.$options.length&&(self.$options.each(function(i){var $option=$(this);$option.is(":selected")&&(self.selected={index:i,title:$option.text()},self.focusIndex=i),$option.hasClass("label")&&0===i?(self.hasLabel=!0,self.label=$option.text(),$option.attr("value","")):self.options.push({domNode:$option[0],title:$option.text(),value:$option.val(),selected:$option.is(":selected")})}),self.selected||(self.selected={index:0,title:self.$options.eq(0).text()},self.focusIndex=0),self.render())},render:function(){var self=this,touchClass=self.isTouch&&self.nativeTouch?" touch":"",disabledClass=self.disabled?" disabled":"";self.$container=self.$select.wrap('<div class="'+self.wrapperClass+touchClass+disabledClass+'"><span class="old"/></div>').parent().parent(),self.$active=$('<span class="selected">'+self.selected.title+"</span>").appendTo(self.$container),self.$carat=$('<span class="carat"/>').appendTo(self.$container),self.$scrollWrapper=$("<div><ul/></div>").appendTo(self.$container),self.$dropDown=self.$scrollWrapper.find("ul"),self.$form=self.$container.closest("form"),$.each(self.options,function(){var option=this,active=option.selected?' class="active"':"";self.$dropDown.append("<li"+active+">"+option.title+"</li>")}),self.$items=self.$dropDown.find("li"),self.cutOff&&self.$items.length>self.cutOff&&self.$container.addClass("scrollable"),self.getMaxHeight(),self.isTouch&&self.nativeTouch?self.bindTouchHandlers():self.bindHandlers()},getMaxHeight:function(){var self=this;self.maxHeight=0;for(var i=0;i<self.$items.length;i++){var $item=self.$items.eq(i);if(self.maxHeight+=$item.outerHeight(),self.cutOff===i+1)break}},bindTouchHandlers:function(){var self=this;self.$container.on("click.easyDropDown",function(){self.$select.focus()}),self.$select.on({change:function(){var $selected=$(this).find("option:selected"),title=$selected.text(),value=$selected.val();self.$active.text(title),"function"==typeof self.onChange&&self.onChange.call(self.$select[0],{title:title,value:value})},focus:function(){self.$container.addClass("focus")},blur:function(){self.$container.removeClass("focus")}})},bindHandlers:function(){var self=this;self.query="",self.$container.on({"click.easyDropDown":function(){self.down||self.disabled?self.close():self.open()},"mousemove.easyDropDown":function(){self.keyboardMode&&(self.keyboardMode=!1)}}),$("body").on("click.easyDropDown."+self.id,function(e){var $target=$(e.target),classNames=self.wrapperClass.split(" ").join(".");!$target.closest("."+classNames).length&&self.down&&self.close()}),self.$items.on({"click.easyDropDown":function(){var index=$(this).index();self.select(index),self.isTouch&&self.nativeTouch!==!0||self.$select.focus()},"mouseover.easyDropDown":function(){if(!self.keyboardMode){var $t=$(this);$t.addClass("focus").siblings().removeClass("focus"),self.focusIndex=$t.index()}},"mouseout.easyDropDown":function(){self.keyboardMode||$(this).removeClass("focus")}}),self.$select.on({"focus.easyDropDown":function(){self.$container.addClass("focus"),self.inFocus=!0},"blur.easyDropDown":function(){self.$container.removeClass("focus"),self.inFocus=!1},"keydown.easyDropDown":function(e){if(self.inFocus){self.keyboardMode=!0;var key=e.keyCode;if((38==key||40==key||32==key)&&(e.preventDefault(),38==key?(self.focusIndex--,self.focusIndex=self.focusIndex<0?self.$items.length-1:self.focusIndex):40==key&&(self.focusIndex++,self.focusIndex=self.focusIndex>self.$items.length-1?0:self.focusIndex),self.down||self.open(),self.$items.removeClass("focus").eq(self.focusIndex).addClass("focus"),self.cutOff&&self.scrollToView(),self.query=""),self.down)if(9==key||27==key)self.close();else{if(13==key)return e.preventDefault(),self.select(self.focusIndex),self.close(),!1;if(8==key)return e.preventDefault(),self.query=self.query.slice(0,-1),self.search(),clearTimeout(self.resetQuery),!1;38!=key&&40!=key&&(self.query+=String.fromCharCode(key),self.search(),clearTimeout(self.resetQuery))}}},"keyup.easyDropDown":function(){self.resetQuery=setTimeout(function(){self.query=""},1200)}}),self.$dropDown.on("scroll.easyDropDown",function(e){self.$dropDown[0].scrollTop>=self.$dropDown[0].scrollHeight-self.maxHeight?self.$container.addClass("bottom"):self.$container.removeClass("bottom")}),self.$form.length&&self.$form.on("reset.easyDropDown",function(){var active=self.hasLabel?self.label:self.options[0].title;self.$active.text(active)})},unbindHandlers:function(){var self=this;self.$container.add(self.$select).add(self.$items).add(self.$form).add(self.$dropDown).off(".easyDropDown"),$("body").off("."+self.id)},open:function(){var self=this,scrollTop=window.scrollY||document.documentElement.scrollTop,scrollLeft=window.scrollX||document.documentElement.scrollLeft,scrollOffset=self.notInViewport(scrollTop);self.closeAll(),self.getMaxHeight(),self.isTouch&&self.nativeTouch!==!0||self.$select.focus(),window.scrollTo(scrollLeft,scrollTop+scrollOffset),self.$container.addClass("open"),self.$scrollWrapper.css("height",self.maxHeight+"px"),self.down=!0},close:function(){var self=this;self.$container.removeClass("open"),self.$scrollWrapper.css("height","0px"),self.focusIndex=self.selected.index,self.query="",self.down=!1},closeAll:function(){var self=this,instances=Object.getPrototypeOf(self).instances;for(var key in instances){var instance=instances[key];instance.close()}},select:function(index){var self=this;"string"==typeof index&&(index=self.$select.find('option[value="'+index+'"]').index());var option=self.options[index],selectIndex=self.hasLabel?index+1:index;self.$items.removeClass("active").eq(index).addClass("active"),self.$active.text(option.title),self.$select.find("option").removeAttr("selected").eq(selectIndex).prop("selected",!0).parent().trigger("change"),self.selected={index:index,title:option.title},self.focusIndex=index,"function"==typeof self.onChange&&self.onChange.call(self.$select[0],{title:option.title,value:option.value})},search:function(){var i,title,self=this,lock=function(i){self.focusIndex=i,self.$items.removeClass("focus").eq(self.focusIndex).addClass("focus"),self.scrollToView()},getTitle=function(i){return self.options[i].title.toUpperCase()};for(i=0;i<self.options.length;i++)if(title=getTitle(i),0===title.indexOf(self.query))return void lock(i);for(i=0;i<self.options.length;i++)if(title=getTitle(i),title.indexOf(self.query)>-1){lock(i);break}},scrollToView:function(){var self=this;if(self.focusIndex>=self.cutOff){var $focusItem=self.$items.eq(self.focusIndex),scroll=$focusItem.outerHeight()*(self.focusIndex+1)-self.maxHeight;self.$dropDown.scrollTop(scroll)}},notInViewport:function(scrollTop){var self=this,range={min:scrollTop,max:scrollTop+(window.innerHeight||document.documentElement.clientHeight)},menuBottom=self.$dropDown.offset().top+self.maxHeight;return menuBottom>=range.min&&menuBottom<=range.max?0:menuBottom-range.max+5},destroy:function(){var self=this;self.unbindHandlers(),self.$select.unwrap().siblings().remove(),self.$select.unwrap(),delete Object.getPrototypeOf(self).instances[self.$select[0].id]},disable:function(){var self=this;self.disabled=!0,self.$container.addClass("disabled"),self.$select.attr("disabled",!0),self.down||self.close()},enable:function(){var self=this;self.disabled=!1,self.$container.removeClass("disabled"),self.$select.attr("disabled",!1)},update:function(){var settings;return this.$options=this.$select.find("option"),this.$options.length!==this.options.length&&(settings=this.settings,this.destroy(),this.init(this.$select[0],settings)),this}};var instantiate=function(domNode,settings){domNode.id=domNode.id?domNode.id:"EasyDropDown"+rand();var instance=new EasyDropDown;instance.instances[domNode.id]||(instance.instances[domNode.id]=instance,instance.init(domNode,settings))},rand=function(){return("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase()};$.fn.easyDropDown=function(){var eachReturn,args=arguments,dataReturn=[];return eachReturn=this.each(function(){if(args&&"string"==typeof args[0]){var data=EasyDropDown.prototype.instances[this.id][args[0]](args[1],args[2]);data&&dataReturn.push(data)}else instantiate(this,args[0])}),dataReturn.length?dataReturn.length>1?dataReturn:dataReturn[0]:eachReturn},$(function(){"function"!=typeof Object.getPrototypeOf&&("object"==typeof"test".__proto__?Object.getPrototypeOf=function(object){return object.__proto__}:Object.getPrototypeOf=function(object){return object.constructor.prototype}),$("select.dropdown").each(function(){var json=$(this).attr("data-settings");settings=json?$.parseJSON(json):{},instantiate(this,settings)})})}(jQuery);
